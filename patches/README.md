Как правильно создавать и применять патчи

Определите номер патча. В каталоге patches/ лежат все ранее применённые diff‑файлы (1.ir-skeleton.diff, 2.ir-optimizer.diff, 3.ir-fill.diff, 4.ir-instructions-proper.diff и т.д.). Новый патч должен иметь следующий свободный номер, чтобы было понятно, в каком порядке они применялись (например, следующий будет 5.<описание>.diff).

Сделайте изменения в коде. Внесите правки в исходники в соответствии с задачей (создайте/измените файлы). Обязательно проверяйте, что вы не меняете то, что уже сделано предыдущими патчами.

Создайте unified‑diff. После того как изменения готовы и проиндексированы, сгенерируйте diff с помощью Git, который будет применим через git apply:

# убедитесь, что все изменения добавлены в индекс
`git add <изменённые файлы>`
# создаём diff-файл с нужным именем (пример для патча 5)
`git diff --staged > patches/5.<описание>.diff`


Такой diff содержит номера строк и контекст, поэтому корректно применится к последней версии кода.

Проверьте патч локально. Запустите git apply --check patches/5.<описание>.diff — если ошибок нет, патч сформирован правильно. При необходимости поправьте код или diff и повторите проверку.

Коммит. Коммит должен содержать как сами изменения, так и diff‑файл. В качестве сообщения коммита используйте точное имя патча — это упростит поиск:

```shell
git commit -am "5.<описание>.diff"
git push origin main
```


Тесты. После пуша GitHub Actions автоматически запустит тесты. При ошибках можно открыть patch‑файл, исправить код и перегенерировать diff со следующим номером (например, 6.fix-tests.diff).

Правила именования. В имени диффа после номера дайте короткое описание (латиницей без пробелов, лучше через дефис), например 5.ir-cfg-builder.diff. Оно отражает суть правки, но не повторяет названия предыдущих патчей.

Не добавляйте уже применённые правки. Создавайте diff‑файлы только на основе текущего состояния ветки main. Если нужно изменить ранее добавленную логику, создавайте новый патч с соответствующими изменениями, а не редактируйте старые diff‑файлы.